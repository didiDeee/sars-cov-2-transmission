(this["webpackJsonpsars-cov-2-transmission"]=this["webpackJsonpsars-cov-2-transmission"]||[]).push([[0],{130:function(t,e,n){"use strict";n.r(e);var a=n(5),o=n.n(a),i=n(19),r=n.n(i),s=(n(64),n(65),n(66),n(25)),c=n(22),u=n(32),l=n(31),h=n(11);function d(t){if(null==t||""==t)return{};try{return JSON.parse(t)}catch(e){return{}}}function p(t){return 500===t.status?Promise.resolve({}):t.text().then(d)}var f=function t(){Object(h.a)(this,t)};f.getSimpleInfo=function(){return new Promise((function(t,e){fetch("https://api.opencovid.ca/summary").then((function(e){console.log(e),e.text().then(t)})).catch((function(t){e(t)}))}))},f.getCasesByDayAndHealthUnit=function(t,e){var n=t.format("YYYY-MM-DD"),a="https://api.opencovid.ca/summary?stat=cases&before="+n+"&after="+n+"&loc="+e;return new Promise((function(t,e){fetch(a).then((function(e){p(e).then((function(e){console.log(e);var n=e.summary[0];t(n.cases)}))})).catch((function(t){e(t)}))}))},f.getTotalPopulationByHealthUnit=function(t){return new Promise((function(e,n){fetch("https://api.opencovid.ca/other?stat=hr").then((function(n){p(n).then((function(n){n.hr.forEach((function(n){n.HR_UID==t&&e(n.pop)})),e(-1)}))})).catch((function(t){n(t)}))}))},f.getCodesAndPopulations=function(){return new Promise((function(t,e){fetch("https://api.opencovid.ca/other?stat=hr").then((function(e){p(e).then((function(e){var n=e.hr,a=new Map;n.forEach((function(t){a.set(t.province+"|"+t.health_region,{id:t.HR_UID,pop:t.pop})})),t(a)}))})).catch((function(t){e(t)}))}))},f.getLocationData=function(t,e){var n="https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&sensor=true&key=AIzaSyBL3Obbx4Z6ziRQpgMq0Sy3QeQa-HYON7Y";return new Promise((function(t){fetch(n).then((function(e){p(e).then((function(e){var n=e.results[0].address_components,a=[];n.forEach((function(t){t.short_name.split(" ").forEach((function(t){t.length>=4&&a.push(t)}))})),t(a)}))}))}))};var g=n(4),b=function(t){Object(u.a)(n,t);var e=Object(l.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(g.jsx)("div",{className:"d-flex justify-content-center",children:Object(g.jsx)("div",{className:"spinner-border",role:"status",children:Object(g.jsx)("span",{className:"sr-only",children:"Loading..."})})})}}]),n}(a.Component),m=n(57),j=n.n(m),v=n(23),y=n.n(v),O=(n(69),function(t){Object(u.a)(n,t);var e=Object(l.a)(n);function n(t){var a;return Object(h.a)(this,n),(a=e.call(this,t)).state={error:null,isLoaded:!1,simpleData:"",longitude:"",latitude:"",healthUnit:"",pickedDate:y()().subtract(1,"day").toDate(),populationMap:new Map,percentage:""},a.onDatePick=a.onDatePick.bind(Object(c.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(c.a)(a)),a}return Object(s.a)(n,[{key:"findLocation",value:function(t){for(var e=0,n=Array.from(this.state.populationMap.entries());e<n.length;e++){var a=n[e][0];if(a.includes(t))return a}return""}},{key:"handleSubmit",value:function(t){var e=this;this.setState({isLoaded:!1,error:null});var n=y()(this.state.pickedDate);if(this.state.healthUnit){var a=parseInt(this.state.healthUnit);f.getCasesByDayAndHealthUnit(n,a).then((function(t){for(var n=-1,o="N/A",i=0,r=Array.from(e.state.populationMap.entries());i<r.length;i++){var s=r[i],c=s[1];c.id==a&&(n=c.pop,o=s[0])}var u=(t/n*.32*100).toFixed(4).toString()+"%";e.setState({percentage:o+": "+u,longitude:e.state.longitude,latitude:e.state.latitude,healthUnit:"",error:null,isLoaded:!0})}))}else f.getLocationData(this.state.latitude,this.state.longitude).then((function(t){console.log("matches"),console.log(t);for(var a=!1,o="",i=0;i<t.length;i++){var r=t[i];if((o=e.findLocation(r)).length>0)if("break"===function(){console.log("using location: "+o),a=!0;var t=e.state.populationMap.get(o).pop,i=e.state.populationMap.get(o).id;return f.getCasesByDayAndHealthUnit(n,i).then((function(n){var a=(n/t*.32*100).toFixed(4).toString()+"%";e.setState({percentage:o+": "+a,longitude:e.state.longitude,latitude:e.state.latitude,error:null,isLoaded:!0})})),"break"}())break}a||e.setState({error:new Error("cannot find location, try using the health code instead"),isLoaded:!0,percentage:"cannot find location, try using the health code instead"})}))}},{key:"componentDidMount",value:function(){var t=this;f.getSimpleInfo().then((function(e){t.setState({error:null,isLoaded:!0,simpleData:e})}),(function(e){t.setState({error:e})})),f.getCodesAndPopulations().then((function(e){t.setState({populationMap:e}),console.log(e)}))}},{key:"onDatePick",value:function(t){console.log(t),t?Array.isArray(t)?this.setState({pickedDate:t[0]}):this.setState({pickedDate:t}):this.setState({pickedDate:y()().toDate()})}},{key:"render",value:function(){var t=this;if(!this.state.isLoaded)return Object(g.jsx)(b,{});var e=Object(g.jsx)("div",{}),n=Object(g.jsx)("div",{});this.state.error&&(e=Object(g.jsx)("div",{children:"Unexpected Error, please try again later"}));this.state.simpleData;return Object(g.jsxs)("div",{className:"lookup",children:[e,n,Object(g.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Date"}),Object(g.jsx)(j.a,{selected:this.state.pickedDate,onChange:this.onDatePick})]}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Location"}),Object(g.jsx)("input",{type:"number",step:"0.0000001",className:"form-control",id:"lattitude",placeholder:"lattitude",onChange:function(e){return t.setState({latitude:e.target.value})}}),Object(g.jsx)("input",{type:"number",step:"0.0000001",className:"form-control",id:"longitutde",placeholder:"longitutde",onChange:function(e){t.setState({longitude:e.target.value})}}),Object(g.jsx)("input",{type:"text",className:"form-control",id:"user-name-owner",placeholder:"health unit code",onChange:function(e){return t.setState({healthUnit:e.target.value})}}),Object(g.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Search"})]})]}),Object(g.jsxs)("div",{children:["percentage: ",this.state.percentage]})]})}}]),n}(o.a.Component));var x=function(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(O,{})})},S=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,134)).then((function(e){var n=e.getCLS,a=e.getFID,o=e.getFCP,i=e.getLCP,r=e.getTTFB;n(t),a(t),o(t),i(t),r(t)}))};r.a.render(Object(g.jsx)(o.a.StrictMode,{children:Object(g.jsx)(x,{})}),document.getElementById("root")),S()},64:function(t,e,n){},66:function(t,e,n){}},[[130,1,2]]]);
//# sourceMappingURL=main.f3aee8ae.chunk.js.map